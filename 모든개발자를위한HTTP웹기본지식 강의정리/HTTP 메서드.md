# HTTP API를 만들어 보자

#### API를 설계할 때 가장 중요한 것은 리소스 식별

#### 리소스?

- 회원을 등록 -> 회원이라는 개념이 리소스

- 등록, 수정 이런 동사는 모두 배제하고 회원 리소스를 URI에 매핑해야한다

  ex) 조회 members/

  ​	  수정 members/{id}

  ​	  삭제 members/{id}

- 참고 : 계층 구조상 상위를 컬렉션으로 보고 복수단어 사용권장 (member -> members)

- 위의 조회, 수정, 삭제 등을 구별하는 방법 -> 행위로 구분 -> HTTP 메서드로 구분한다.





# HTTP 메서드

- 요약정리
  - GET : 리소스 조회
  - POST : 요청 데이터처리, 주로 등록에 사용
  - PUT : 리소스를 대체, 해당 리소스가 없으면 생성
  - PATCH : 리소스 부분 변경
  - DELETE : 리소스 삭제
  - 이외에도 있지만 잘 안씀



## 1. GET

- 리소스 조회할 때 사용한다
- 서버에 전달하고 싶은 데이터는 query-string을 통해 전달 ex) ?q=hello&hl=ko
- 메세지 바디를 사용해서 데이터를 전달할 수 있지만, 지원하지 않는 곳이 많아 권장하지 않음



## 2. POST

- 클라이언트 -> 서버로 요청을 보낼때 데이터를 같이 줄테니 이걸 처리해라!
- 요청데이터 처리
- 메세지 바디를 통해 서버로 요청데이터 전달 (요청 메세지 body)
- 메세지 바디를 통해 들어온 데이터를 처리하는 **모든기능**을 수행한다.
- 주로 신규 등록, 변경된 프로세스 처리 (배달 상태 변경.. 이런거..?)



- 요청데이터를 어떻게 처리하는 뜻일까?
  - HTML 양식에 입력된 필드와 같은 데이터 블록을 데이터 처리 프로세스에 제공.. 
  - 게시판, 뉴스 그룹 등 글쓰기 기능
  - 서버가 아직 식별하지 않은 새 리소스 생성 ex) 신규 주문
  - 기존 자원에 데이터 추가 -> 수정..!
- 이 리소스에 POST 요청이 오면 데이터를 어떻게 처리할지 리소스마다 따로 정해야한다.



- 단순히 데이터를 생성하는 것과 변경하는 것을 넘어 <u>프로세스를 처리해야 하는 경우도 POST</u>를 쓴다
  - ex) 주문 -> 결제완료 -> 배달시작 -> 배달 완료 이렇게 프로세스가 변경회는 경우.. 



- POST를 쓴다고 꼭  새로운 리소스가 생성되는 것이 아님!
  - ex) POST /orders/{orderId}/start-delivery 
  - 이처럼 동사를 잘 안쓰는데 동사를 쓰는 URI(어쩔수 없이) -> **컨트롤 URI** -> POST로 많이 처리함



- 다른 메서드로 처리하기 애매한 경우도 POST 사용

  - ex) JSON으로 데이터를 넘겨 조회를 해야하는데 GET을 사용하기 어려운 경우
  - 애매하면 POST :)

  

## 3. PUT

- 리소스를 대체한다. (파일 복사의 느낌)
- 리소스가 있으면 대체, 없으면 생성
- 클라이언트가 리소스를 식별하여 URI를 지정한다. ex) PUT /members/100 .... {age: 20, name:lee}
  - POST는 리소스를 모른다... POST와의 차이점..
- 수정하려는 필드가 전체적으로 있어야함
  - {name:lee, age:20} 으로 수정해야하는데, {age:10} 이것만 있으면 <u>name은 null</u> 이 되어버림.. 
- 데이터는 바디로 보내면 된다.

## 4. PATCH

- 리소스의 부분변경
- 지원 안하는 서버같은 경우 POST를 쓰면된다
- 데이터는 바디로 보내면 된다.

## 5. DELETE

- 리소스를 제거한다.





# HTTP 메서드의 속성



## 1. 안전

- 호출해도 리소스를 변경하지 않는다 -> GET

- 안전은 해당 리소스의 변화 유무만을 고려함 -> 로그쌓여서 장애 이런거 고려 안함 

  

## 2. 멱등

- 한번 호출하든 100번 호출하든 결과는 똑같음
- 멱등 메서드
  - GET : 한 번 조회하든, 100번 조회하든 같은 결과 조회됨
  - PUT : 결과를 대체 -> 같은 요청을 여러번 해도 최종 결과는 같음 (같은 데이터를 계속 수정 요청하면 같은 걸로 계속 수정 요청하는 거니까..)
  - DELETE: 결과 삭제 -> 같은 요청을 여러번 해도 마지막에 해당 리소스가 없는 결과는 같음
- **POST는 멱등이 아니다**
  - 결제의 경우 두 번 호출하면 같은 결제가 중복해서 발생할 수 있다. (같은 리소스를 계속 생성 요청하면 계속 새로운 리소스가 만들어 지는거임)



- 멱등판단의 기준?

  - 서버가 TIMEOUT 등으로 정상 등답을 못 주 었을 떄, 클라이언트가 같은 요청을 다시해도 되는가 

- 멱등은 외부 요인으로 중간에 리소스가 변경되는 것은 고려하지 않음 (중간에 다른 사용자가 변경한건 상관하지 않는다는 말..)

  

## 3. 캐시가능

- 응답 결과 리소스를 캐시해서 사용해도 되는가 (한 번 다운로드 받은 리소스들을 다시 사용할 수 있는가?)
- GET, HEAD, POST, PATCH 캐시가능
- 실제로는 **GET, HEAD** 정도만 캐시로 하용
- POST, PATCH는 본문 내용까지 캐시 키로 고려해야해서 구현이 쉽지 않아서 잘 안씀

